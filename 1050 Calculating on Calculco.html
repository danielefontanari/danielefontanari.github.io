<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(13)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(13) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(13) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(13) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Calculating on Calculco | A linux crash course</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Calculating on Calculco" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Learn Linux the fun way!" /> <meta property="og:description" content="Learn Linux the fun way!" /> <link rel="canonical" href="/1050%20Calculating%20on%20Calculco.html" /> <meta property="og:url" content="/1050%20Calculating%20on%20Calculco.html" /> <meta property="og:site_name" content="A linux crash course" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Calculating on Calculco" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Learn Linux the fun way!","headline":"Calculating on Calculco","url":"/1050%20Calculating%20on%20Calculco.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> A linux crash course </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/0050%20Connection%20from%20a%20local%20machine.html" class="nav-list-link">Connection from a local machine</a></li><li class="nav-list-item"><a href="/0100%20The%20front-end%20and%20data%20transfer.html" class="nav-list-link">The front-end and data transfer machines</a></li><li class="nav-list-item"><a href="/0200%20Introduction%20to%20BASH.html" class="nav-list-link">Introduction to BASH</a></li><li class="nav-list-item"><a href="/0300%20The%20pwd%20Command.html" class="nav-list-link">The pwd Command</a></li><li class="nav-list-item"><a href="/0400%20The%20ls%20Command.html" class="nav-list-link">The ls Command</a></li><li class="nav-list-item"><a href="/0500%20The%20cd%20Command.html" class="nav-list-link">The cd Command</a></li><li class="nav-list-item"><a href="/0550%20Understanding%20Storage%20Spaces%20on%20Calculco.html" class="nav-list-link">Understanding Storage Spaces on Calculco</a></li><li class="nav-list-item"><a href="/0600%20Creating%20and%20Removing%20Directories.html" class="nav-list-link">Creating and Removing Directories</a></li><li class="nav-list-item"><a href="/0700%20Creating%20files%20and%20Basic%20Text%20Editing.html" class="nav-list-link">Creating files and Basic Text Editing</a></li><li class="nav-list-item"><a href="/0800%20Copying%20Files%20and%20Directories.html" class="nav-list-link">Copying Files and Directories</a></li><li class="nav-list-item"><a href="/0900%20Moving%20and%20Renaming%20Files.html" class="nav-list-link">Moving and Renaming Files</a></li><li class="nav-list-item"><a href="/1000%20Removing%20Files.html" class="nav-list-link">Removing Files</a></li><li class="nav-list-item"><a href="/1050%20Calculating%20on%20Calculco.html" class="nav-list-link">Calculating on Calculco</a></li><li class="nav-list-item"><a href="/1070%20Using%20matlab%20on%20calculco.html" class="nav-list-link">Using matlab on calculco</a></li><li class="nav-list-item"><a href="/1100%20Advanced%20File%20Operations%20and%20Globbing.html" class="nav-list-link">Advanced File Operations and Globbing</a></li><li class="nav-list-item"><a href="/1200%20Useful%20BASH%20tricks.html" class="nav-list-link">Useful BASH tricks</a></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search A linux crash course" aria-label="Search A linux crash course" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="calculating-on-calculco"> <a href="#calculating-on-calculco" class="anchor-heading" aria-labelledby="calculating-on-calculco"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Calculating on Calculco </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li> <li><a href="#the-computing-nodes" id="markdown-toc-the-computing-nodes">The computing nodes</a></li> <li><a href="#the-oar-task-manager" id="markdown-toc-the-oar-task-manager">The OAR task manager</a></li> <li><a href="#interactive-jobs" id="markdown-toc-interactive-jobs">Interactive jobs</a></li> <li><a href="#batch-jobs" id="markdown-toc-batch-jobs">Batch jobs</a></li> <li><a href="#batch-scripts" id="markdown-toc-batch-scripts">Batch scripts</a></li> </ol><hr /> <h2 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction </h2> <p>As mentioned before no calculations should be done on the front-end. In this lesson we will learn how to access and the various ways to use the computing nodes</p> <h2 id="the-computing-nodes"> <a href="#the-computing-nodes" class="anchor-heading" aria-labelledby="the-computing-nodes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The computing nodes </h2> <p>The computing nodes are the machines that should be used when computations should be done. Each node has the identificative name <code class="language-plaintext highlighter-rouge">orval##</code> where <code class="language-plaintext highlighter-rouge">##</code> is a number. Each node has its characteristics and more informations can be found <a href="https://www-calculco.univ-littoral.fr/ressources/equipements">here</a>.</p> <h2 id="the-oar-task-manager"> <a href="#the-oar-task-manager" class="anchor-heading" aria-labelledby="the-oar-task-manager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The OAR task manager </h2> <p>Since the enviroment is shared among multiple users a queue system is used. When asking for a resource (through what is called a job) the user is put in a queue. When the top of the queue is reached the resource is assigned to the user for a given Walltime.</p> <p>The system that handle the queue is OAR. in the following we will uncover its basic usage.</p> <p>The command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarstat
</code></pre></div></div> <p>allows to see the current status of the cluster, for example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dfontanari@calculco:~$ oarstat
Job id    S User     Duration   System message
--------- - -------- ---------- ------------------------------------------------
3991376   R sbertin   170:44:23 R=4,W=400:0:0,J=B,N=Lagr_divergence_2dVar_BOBLIT01,T=besteffort|idempotent (Karma=0.095,quota_ok)
3991377   R sbertin   170:44:05 R=4,W=400:0:0,J=B,N=Lagr_divergence_2dVar_BOBLIT02,T=besteffort|idempotent (Karma=0.095,quota_ok)
[...]
4091254   R dfontana    0:00:10 R=2,W=2:0:0,J=I (Karma=0.196,quota_ok)
</code></pre></div></div> <p>in this representation the first column (<code class="language-plaintext highlighter-rouge">Job id</code>) represents an unique identificative number of the reservation, the second column (<code class="language-plaintext highlighter-rouge">S</code>) represents the status of the calculation, <code class="language-plaintext highlighter-rouge">R</code> means that the calculation is running, <code class="language-plaintext highlighter-rouge">W</code> that the calculation is waiting in the queue, the third column (<code class="language-plaintext highlighter-rouge">User</code>) represents the user who requested the calculation, the fourth column (<code class="language-plaintext highlighter-rouge">Duration</code>) represent the amount of time passed since the computation started. The last column (<code class="language-plaintext highlighter-rouge">System message</code>) encapsulate several informations about the computation for instance the number of parallel process is using (<code class="language-plaintext highlighter-rouge">R</code>), the amount of time requested (<code class="language-plaintext highlighter-rouge">W</code>), the type of computation (<code class="language-plaintext highlighter-rouge">J</code>): <code class="language-plaintext highlighter-rouge">B</code> represents a batch computation (no interaction with the user that launched the computation) and <code class="language-plaintext highlighter-rouge">I</code> represents a interactive computation (the user is connected on the node as if it is a linux system). Then <code class="language-plaintext highlighter-rouge">N</code> represents the name of the computation (optional) and <code class="language-plaintext highlighter-rouge">T</code> gives extra informations about the type of job requested, in particular besteffort means that the user allows the job to run with a very low priority (other user can decide to stop the job if they need the resource), but it allows at the same time for the user to be granted a large number of resources or a very long walltime (in general there are constraints on these), idempotent means that id the job is stopped by another user it is put automatically in the queue and will restart as soon as possible.</p> <p>if we need more informations about a job we can use the <code class="language-plaintext highlighter-rouge">-f</code> flag along with the specification of the flag <code class="language-plaintext highlighter-rouge">-j</code> to indicate the job, for instance</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarstat <span class="nt">-fj</span> 4091254
</code></pre></div></div> <p>gives:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Job_Id: 4091254
    job_array_id = 4091254
    job_array_index = 1
    name = 
    project = default
    owner = dfontanari
    state = Running
    wanted_resources = -l "{type = 'default'}/network_address=1/cpu=1/core=2,walltime=2:0:0" 
    types = 
    dependencies = 
    assigned_resources = 253+254
    assigned_hostnames = orval10
    queue = default
    command = 
    launchingDirectory = /nfs/home/lpca/dfontanari
    stdout_file = OAR.4091254.stdout
    stderr_file = OAR.4091254.stderr
    jobType = INTERACTIVE
    properties = (((gpu=0) AND desktop_computing = 'NO') AND ( dedicated='NO' OR dedicated='LPCA' OR dedicated='PCS' )) AND drain='NO'
    reservation = None
    walltime = 2:0:0
    submissionTime = 2023-12-19 15:47:15
    startTime = 2023-12-19 15:47:16
    cpuset_name = dfontanari_4091254
    initial_request = oarsub -I -l /nodes=1/cpu=1/core=2 -p gpu=0
    message = R=2,W=2:0:0,J=I (Karma=0.196,quota_ok)
    scheduledStart = 2023-12-19 15:47:16
    resubmit_job_id = 0
    events = 
</code></pre></div></div> <p>we can see for instance that this job runs on orval10, and has been launched from <code class="language-plaintext highlighter-rouge">/nfs/home/lpca/dfontanari</code>.</p> <h2 id="interactive-jobs"> <a href="#interactive-jobs" class="anchor-heading" aria-labelledby="interactive-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interactive jobs </h2> <p>The first way to use the computing nodes is to use them interactively. This is done by using the command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-I</span>
</code></pre></div></div> <p>this command will put the user in the queue and when the user reaches the top of the queue it will be connected to the node. The user will be able to use the node as if it was a linux system. The user can then launch its computations on the node. When the user is done with the node it can exit the node by typing <code class="language-plaintext highlighter-rouge">exit</code> or by pressing <code class="language-plaintext highlighter-rouge">Ctrl+D</code>. The user will then be disconnected from the node and the node will be available for other users.</p> <p>Without specification the command <code class="language-plaintext highlighter-rouge">oarsub -I</code> will put the user in the queue for a default amount of time (2 hours) and will request a default amount of resources (1 node, 1 cpu, 1 core). This can be useful for testing purposes or for small computations. However for larger computations it is better to specify the amount of resources and the amount of time needed. This can be done by using the <code class="language-plaintext highlighter-rouge">-l</code> flag. For instance</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-I</span> <span class="nt">-l</span> /nodes<span class="o">=</span>2/cpu<span class="o">=</span>3/core<span class="o">=</span>4,walltime<span class="o">=</span>4:0:0
</code></pre></div></div> <p>will request 4 hours of computation times and will request 2 nodes, 3 cpus for each node and 4 cores for each cpu (for a total of 24 parallel processes).</p> <blockquote class="tip"> <p>working on multiple nodes is an advanced topic and should be avoided. the number of processes for each node is given by cpu*core, so in term of number of processes (12), the following commands are equivalent:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-I</span> <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>4/core<span class="o">=</span>3,walltime<span class="o">=</span>4:0:0
oarsub <span class="nt">-I</span> <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>3/core<span class="o">=</span>4,walltime<span class="o">=</span>4:0:0
oarsub <span class="nt">-I</span> <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>2/core<span class="o">=</span>6,walltime<span class="o">=</span>4:0:0
oarsub <span class="nt">-I</span> <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>1/core<span class="o">=</span>12,walltime<span class="o">=</span>4:0:0
oarsub <span class="nt">-I</span> <span class="nt">-l</span> /nodes<span class="o">=</span>1/core<span class="o">=</span>12,walltime<span class="o">=</span>4:0:0
</code></pre></div> </div> <p>however using multiple cpus will allow the job to access more memory. Note that in the last case the number of cpu is not specified and the system will automatically choose the number of cpus to use.</p> </blockquote> <p>it is possible to use the flag <code class="language-plaintext highlighter-rouge">-p</code> in order to specify the properties of the node that should be used. For instance</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-I</span> <span class="nt">-p</span> <span class="s1">'host="orval10"'</span> <span class="nt">-l</span> /core<span class="o">=</span>2
</code></pre></div></div> <p>will request the node orval10 and will use 2 core of the node.</p> <p>When the job is started the user will be logged in the node and will be able to use it as if it was a linux system. The user can then launch its computations on the node. When the user is done with the node it can exit the node by typing <code class="language-plaintext highlighter-rouge">exit</code> or by pressing <code class="language-plaintext highlighter-rouge">Ctrl+D</code>. The user will then be disconnected from the node and the node will be available for other users.</p> <h2 id="batch-jobs"> <a href="#batch-jobs" class="anchor-heading" aria-labelledby="batch-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Batch jobs </h2> <p>The second way to use the computing nodes is to use them in batch mode. This is done by using the command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-S</span> ./my_script
</code></pre></div></div> <p>this will put the user in the queue and when the user reaches the top of the queue it will execute the script <code class="language-plaintext highlighter-rouge">my_script</code> (a script is a file that contains a list of commands that will be executed sequentially). The user will not be connected to the node and when logged out from calculco the job will continue to run.</p> <p>It is possible, as in the interactive case, to specify the amount of resources and the amount of time needed. This can be done by using the <code class="language-plaintext highlighter-rouge">-l</code> flag. For instance</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-S</span> ./my_script <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>2/core<span class="o">=</span>3,walltime<span class="o">=</span>4:0:0
</code></pre></div></div> <p>In the case for a batch job, it might be useful to specify the name of the job, this can be done by using the <code class="language-plaintext highlighter-rouge">-n</code> flag. For instance</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-S</span> ./my_program <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>2/core<span class="o">=</span>3,walltime<span class="o">=</span>4:0:0 <span class="nt">-n</span> <span class="s2">"my_job"</span>
</code></pre></div></div> <p>when the command <code class="language-plaintext highlighter-rouge">oarstat</code> is issued the job will be identified by the name <code class="language-plaintext highlighter-rouge">my_job</code> instead of the job id.</p> <p>In case we want to stop the job we can use the command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oardel &lt;job_id&gt;
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">&lt;job_id&gt;</code> is the id of the job that can be found by using the command <code class="language-plaintext highlighter-rouge">oarstat</code>.</p> <h2 id="batch-scripts"> <a href="#batch-scripts" class="anchor-heading" aria-labelledby="batch-scripts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Batch scripts </h2> <p>In the previous section we have seen how to launch a batch job. However it is not very convenient to have to specify all the parameters of the job in the command line. It is possible to use a script to launch the job. For instance we can edit (using nano for example) a file <code class="language-plaintext highlighter-rouge">my_script.oar</code> (however it is not obligatory to use the <code class="language-plaintext highlighter-rouge">.oar</code> extension) with the following content:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># Normally lines starting with # are comments,</span>
<span class="c"># but when they start with #OAR they are interpreted by OAR</span>
<span class="c"># also the first line of the script is #!/bin/bash means that the script will be executed by the bash shell</span>

<span class="c">#OAR -l /nodes=1/cpu=2/core=3,walltime=4:0:0</span>
<span class="c">#OAR -p 'host="orval10"'</span>
<span class="c">#OAR -n "my_job"</span>

<span class="c"># The script starts here</span>
./my_program
</code></pre></div></div> <p>we need to make the script executable by using the command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x my_script.oar
</code></pre></div></div> <p>and then we can launch the job by using the command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-S</span> ./my_script.oar
</code></pre></div></div> <p>which is equivalent to</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oarsub <span class="nt">-S</span> ./my_program <span class="nt">-l</span> /nodes<span class="o">=</span>1/cpu<span class="o">=</span>2/core<span class="o">=</span>3,walltime<span class="o">=</span>4:0:0 <span class="nt">-p</span> <span class="s1">'host="orval10"'</span> <span class="nt">-n</span> <span class="s2">"my_job"</span>
</code></pre></div></div> <p>Using a script is useful when we want to properly the storage space in calculco. Let suppose that we have an input file called <code class="language-plaintext highlighter-rouge">input.dat</code>, a program called <code class="language-plaintext highlighter-rouge">my_program</code> that accept the input and output files as argument. We can then create a script called <code class="language-plaintext highlighter-rouge">my_script.oar</code> with the following content:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#OAR -l /nodes=1/cpu=2/core=3,walltime=4:0:0</span>
<span class="c">#OAR -p 'host="orval10"'</span>
<span class="c">#OAR -n "my_job"</span>

<span class="c"># copy the input file from the nfs storage to the scratch storage</span>
<span class="nb">cp</span> /nfs/data-unprotected/lpca/dfontanari/input.dat /scratch/lpca/dfontanari/

<span class="c"># run the program and save the output file in the scratch storage</span>
/path/to/my_program <span class="nt">--input</span> /scratch/lpca/dfontanari/input.dat <span class="nt">--output</span> /scratch/lpca/dfontanari/output.dat

<span class="c"># copy the output file from the scratch storage to the nfs storage</span>
<span class="nb">cp</span> /scratch/lpca/dfontanari/output.dat /nfs/data-unprotected/lpca/dfontanari/

<span class="c"># remove the input file from the scratch storage</span>
<span class="nb">rm</span> /scratch/lpca/dfontanari/input.dat /scratch/lpca/dfontanari/output.dat
</code></pre></div></div> <p>If for example we want to to change the number of nodes/cpu/cores or the host we can do it by editing the script without having to change the command line.</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
